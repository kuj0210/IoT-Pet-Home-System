create database USERdata 
	DEFAULT CHARACTER 
	SET utf8 collate utf8_general_ci;

use USERdata;

## Create tables

create table kakaoUser(
	user_key varchar(50),
	Email varchar(50),
	PiKey varchar(50),
	primary key (Email)
	) ENGINE=InnoDB default character set utf8 collate utf8_general_ci;

select * from kakaoUser;

create table naverUser(
	user_key varchar(50),
	Email varchar(50),
	PiKey varchar(50),
	primary key (Email)
	) ENGINE=InnoDB default character set utf8 collate utf8_general_ci;

select * from naverUser;

create table homeSystem(
	PiKey varchar(50),
	Platform varchar(30),
	Email varchar(50),
	url varchar(50)
	) ENGINE=InnoDB default character set utf8 collate utf8_general_ci;

select * from homeSystem;


## insert, delete (homeSystem)

delete from homeSystem where PiKey=%s; %(PiKey)

insert into homeSystem values (%s, %s, %s, %s); %(PiKey, "kako-platform", email, url)
insert into homeSystem values (%s, %s, %s, %s); %(PiKey, "naver-platform", email, url)


## insert user information

1. Is he registed user?

select * from kakaoUser where kakaoUser.email = %s;
select * from naverUser where naverUser.email = %s;

2. If not registed user

select * from kakaoUser where kakaoUser.email=%s and kakaoUser.PiKey=%s;
select * from naverUser where naverUser.email=%s and naverUser.PiKey=%s;

3. Insert user

insert into kakaoUser values (%s, %s, %s); %(user_key, email, PiKey)
insert into naverUser values (%s, %s, %s); %(user_key, email, PiKey)


## find URL and PiKey 

select url,kakaoUser.PiKey 
	from kakaoUser join homeSystem 
	on kakaoUser.Email=homeSystem.Email 
	where kakaoUser.user_key=%s; %(user_key)
select url,naverUser.PiKey 
	from naverUser join homeSystem
	on naverUser.Email=homeSystem.Email 
	where naverUser.user_key=%s; %(user_key)

## check registed user (using in request before executing)

select email from kakaoUser where kakaoUser.user_key=%s; %(user_key)
select email from naverUser where naverUser.user_key=%s; %(user_key)


## find email (information request)

select email from kakaoUser where kakaoUser.user_key=%s; %(user_key)
select email from naverUser where naverUser.user_key=%s; %(user_key)


# get userlist (using in push)

select naverUser.user_key 
	from naverUser join homeSystem
	on naverUser.Email=homeSystem.Email 
	where homeSystem.PiKey=%s; %(PiKey)

